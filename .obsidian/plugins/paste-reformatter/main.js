/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var M=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var V=Object.prototype.hasOwnProperty;var _=(t,c)=>{for(var e in c)M(t,e,{get:c[e],enumerable:!0})},O=(t,c,e,g)=>{if(c&&typeof c=="object"||typeof c=="function")for(let l of B(c))!V.call(t,l)&&l!==e&&M(t,l,{get:()=>c[l],enumerable:!(g=I(c,l))||g.enumerable});return t};var q=t=>O(M({},"__esModule",{value:!0}),t);var j={};_(j,{default:()=>L});module.exports=q(j);var i=require("obsidian");function N(t,c){let e=!1;if(c.htmlRegexReplacements&&c.htmlRegexReplacements.length>0)for(let n of c.htmlRegexReplacements)try{let a=new RegExp(n.pattern,"g"),s=t;t=t.replace(a,n.replacement),s!==t&&(e=!0)}catch(a){console.error(`Error applying regex replacement: ${a}`)}let l=new DOMParser().parseFromString(t,"text/html");if(c.stripLineBreaks?(l.querySelectorAll("br").forEach(a=>{a.remove()}),e=!0):l.querySelectorAll("br").forEach(a=>{var d;let s=l.createElement("p");s.className="preserve-line-break",s.setAttribute("data-preserve","true"),s.textContent="\u200B",(d=a.parentNode)==null||d.replaceChild(s,a)}),c.removeEmptyElements){let n=s=>{if(["img","hr","br","input","iframe"].includes(s.tagName.toLowerCase())||s.hasAttribute("data-preserve")||s.textContent&&s.textContent.length>0)return!1;for(let d=0;d<s.children.length;d++)if(!n(s.children[d]))return!1;return!0},a=!0;for(;a&&(a=!1,l.querySelectorAll("p:not([data-preserve]), div, span, li, ul, ol, table, tr, td, th").forEach(d=>{n(d)&&(d.remove(),a=!0,e=!0)}),!!a););}return{html:new XMLSerializer().serializeToString(l.body),appliedTransformations:e}}function P(t,c,e=0,g=!1){let l=!1;if(c.markdownRegexReplacements&&c.markdownRegexReplacements.length>0)for(let n of c.markdownRegexReplacements)try{let a=new RegExp(n.pattern,"g"),s=t;t=t.replace(a,n.replacement),s!==t&&(l=!0)}catch(a){console.error(`Error applying markdown regex replacement: ${a}`)}if(g){let n=t;t=t.replace(/^(#{1,6}\s)/gm,"\\$1").replace(/(\*\*|__|\*|_)/g,"\\$1").replace(/^(\s*[-+*]\s)/gm,"\\$1").replace(/^(\s*\d+\.\s)/gm,"\\$1").replace(/(!?\[)/g,"\\$1").replace(/(`{1,3})/g,"\\$1").replace(/^(\s*>\s)/gm,"\\$1").replace(/^(\s*[-*_]{3,}\s*)$/gm,"\\$1").replace(/(\|)/g,"\\$1").replace(/^(\s*- \[ \])/gm,"\\$1").replace(/(`.*?`)|(<\/?[a-z][^>]*>)/gi,(a,s,d)=>s||(d?"`"+d+"`":a)),l=n!==t}else{let n=/^(#{1,6})\s/gm;if(c.contextualCascade&&e>0){let a=-1,s=!1;t=t.replace(n,(d,f)=>{let p=f.length,m=p;return s?(m=Math.min(p+a,6),console.log(`contextual cascade: delta ${a}`)):p<=e&&(m=Math.min(e+1,6),a=m-p,s=!0,console.log(`contextual cascade initiated: delta: ${a}`)),console.log(`result: current level: ${p}, new level: ${m}`),l=m!==p,"#".repeat(m)+" "})}else if(c.maxHeadingLevel>1){let a=-1,s=!1;t=t.replace(n,(d,f)=>{let p=f.length,m=p;return c.cascadeHeadingLevels?s?(m=Math.min(p+a,6),console.log(`cascading: delta: ${a}`)):p<c.maxHeadingLevel&&(m=c.maxHeadingLevel,a=m-p,s=!0,console.log(`cascade initiated: delta: ${a}`)):m=Math.max(p,c.maxHeadingLevel),console.log(`result: current level: ${p}, new level: ${m}`),l=m!==p,"#".repeat(m)+" "})}}if(!c.stripLineBreaks){let n="___LINE_BREAK_PLACEHOLDER___";if(t=t.replace(/<p class="preserve-line-break"[^>]*>.*?<\/p>/g,n),t=t.replace(/<p data-preserve="true"[^>]*>.*?<\/p>/g,n),c.removeEmptyLines){t=t.replace(/\r\n/g,`
`);let s=t.split(`
`).filter(f=>f.trim()!==""||f.includes(n)),d=t;t=s.join(`
`),l=d!==t}t=t.replace(new RegExp(n,"g"),`
`)}else if(c.removeEmptyLines){t=t.replace(/\r\n/g,`
`);let a=t.split(`
`).filter(d=>d.trim()!==""),s=t;t=a.join(`
`),l=s!==t}return{markdown:t,appliedTransformations:l}}var z={pasteOverride:!0,maxHeadingLevel:1,removeEmptyElements:!1,cascadeHeadingLevels:!0,contextualCascade:!0,stripLineBreaks:!1,removeEmptyLines:!1,htmlRegexReplacements:[],markdownRegexReplacements:[]},L=class extends i.Plugin{async onload(){await this.loadSettings(),this.addSettingTab(new S(this.app,this)),this.registerEvent(this.app.workspace.on("editor-paste",e=>this.onPaste(e))),this.addCommand({id:"reformat-and-paste",name:"Reformat and Paste",callback:async()=>{try{let e=await this.getClipboardData();e?this.doPaste(e):new i.Notice("Clipboard does not contain HTML or plain text content.")}catch(e){console.error("Error accessing clipboard:",e),new i.Notice("Error accessing clipboard. Try using regular paste instead.")}}}),this.addCommand({id:"paste-with-escaped-markdown",name:"Paste with Escaped Markdown",callback:async()=>{let e=await this.getClipboardData();e?this.doPaste(e,!0):new i.Notice("Clipboard does not contain HTML or plain text content.")}})}onunload(){}async loadSettings(){this.settings=Object.assign({},z,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async getClipboardData(){try{let e=await navigator.clipboard.read(),g=new DataTransfer;for(let l of e){if(l.types.includes("text/html")){let n=await(await l.getType("text/html")).text();g.setData("text/html",n)}if(l.types.includes("text/plain")){let n=await(await l.getType("text/plain")).text();g.setData("text/plain",n)}}if(g.types.includes("text/html")||g.types.includes("text/plain"))return g;new i.Notice("Clipboard does not contain HTML or plain text content.")}catch(e){console.error("Error accessing clipboard:",e),new i.Notice("Error accessing clipboard. Try using regular paste instead.")}return null}doPaste(e,g=!1){let l=this.app.workspace.getActiveViewOfType(i.MarkdownView);if(!l)return!1;let h=l.editor;if(!h)return!1;try{let n="",a=!1,s=!1;if(e.types.includes("text/html")){let p=e.getData("text/html"),m=N(p,this.settings);console.debug(`Original HTML: ${p}`),console.debug(`Transformed HTML: ${m.html}`),n=(0,i.htmlToMarkdown)(m.html),a=m.appliedTransformations}else if(e.types.includes("text/plain"))n=e.getData("text/plain");else return console.debug("No HTML or plain text content found in clipboard"),!1;let d=0;this.settings.contextualCascade&&(d=this.getCurrentHeadingLevel(h));let f=P(n,this.settings,d,g);return s=f.appliedTransformations,a||s?(h.replaceSelection(f.markdown),new i.Notice("Reformatted pasted content"),!0):!1}catch(n){return console.error("Error processing paste content:",n),new i.Notice("Error processing paste content"),!1}}onPaste(e){if(this.settings.pasteOverride){let g=e.clipboardData;if(!g)return;this.doPaste(g)?(console.debug("Default paste behavior overridden by Paste Reformatter plugin"),e.preventDefault()):console.debug("Paste Reformatter plugin did not handle paste, allowing default behavior")}}getCurrentHeadingLevel(e){let l=e.getCursor().line;for(let h=l;h>=0;h--){let a=e.getLine(h).match(/^(#{1,6})\s/);if(a)return a[1].length}return 0}},S=class extends i.PluginSettingTab{constructor(e,g){super(e,g);this.plugin=g}scrollNewRowIntoView(e){let g="regex-replacements-container",l=this.containerEl.querySelectorAll(".regex-replacements-container"),h=e==="html"?l[0]:l[1];if(h){let n=h.querySelector("table");if(n){let a=n.querySelector("tbody");if(a){let s=a.querySelectorAll("tr"),d=s[s.length-1];if(d){let f=this.containerEl.getBoundingClientRect(),p=d.getBoundingClientRect();(p.bottom>f.bottom||p.top<f.top)&&d.scrollIntoView({behavior:"smooth",block:"nearest"})}}}}}display(){let{containerEl:e}=this;e.empty(),new i.Setting(e).setName("Override default paste behavior").setDesc("Alter the behavior of the default paste action to reformat pasted content.").addToggle(o=>o.setValue(this.plugin.settings.pasteOverride).onChange(async r=>{this.plugin.settings.pasteOverride=r,await this.plugin.saveSettings()})),new i.Setting(e).setName("HTML transformations").setHeading().setDesc("Control how the HTML content is processed before being converted to Markdown."),new i.Setting(e).setName("Remove empty elements").setDesc("Remove empty elements when reformatting pasted content").addToggle(o=>o.setValue(this.plugin.settings.removeEmptyElements).onChange(async r=>{this.plugin.settings.removeEmptyElements=r,await this.plugin.saveSettings()})),new i.Setting(e).setName("Strip hard line breaks").setDesc("Remove line breaks (br tags) when reformatting pasted content").addToggle(o=>o.setValue(this.plugin.settings.stripLineBreaks).onChange(async r=>{this.plugin.settings.stripLineBreaks=r,await this.plugin.saveSettings()})),new i.Setting(e).setName("HTML regex replacements").setDesc("Apply regular expression replacements to the HTML content before converting to Markdown. You can use $1, $2, etc. to reference capture groups.");let g=e.createDiv();g.addClass("regex-replacements-container");let l=g.createEl("table");l.addClass("regex-table");let n=l.createEl("thead").createEl("tr"),a=n.createEl("th");a.setText("Pattern"),a.addClass("regex-th"),a.addClass("regex-th-pattern");let s=n.createEl("th");s.setText("Replacement"),s.addClass("regex-th"),s.addClass("regex-th-replacement");let d=n.createEl("th");d.addClass("regex-th"),d.addClass("regex-th-actions");let f=l.createEl("tbody");if(this.plugin.settings.htmlRegexReplacements.forEach((o,r)=>{let w=f.createEl("tr"),R=w.createEl("td");R.addClass("regex-td");let x=document.createElement("input");x.type="text",x.value=o.pattern,x.placeholder="Regular expression pattern",x.addClass("regex-input"),x.addEventListener("change",async()=>{this.plugin.settings.htmlRegexReplacements[r].pattern=x.value,await this.plugin.saveSettings()}),R.appendChild(x);let C=w.createEl("td");C.addClass("regex-td");let v=document.createElement("input");v.type="text",v.value=o.replacement,v.placeholder="Replacement value (can use $1, $2, etc.)",v.addClass("regex-input"),v.addEventListener("change",async()=>{this.plugin.settings.htmlRegexReplacements[r].replacement=v.value,await this.plugin.saveSettings()}),C.appendChild(v);let E=w.createEl("td");E.addClass("regex-td"),E.addClass("regex-td-actions");let u=document.createElement("span");u.className="regex-remove-icon",u.setAttribute("title","Delete"),u.setAttribute("aria-label","Delete"),u.setAttribute("role","button"),u.setAttribute("tabindex","0"),(0,i.setIcon)(u,"trash-2"),u.addEventListener("click",async()=>{this.plugin.settings.htmlRegexReplacements.splice(r,1),await this.plugin.saveSettings(),this.display()}),u.addEventListener("keydown",y=>{(y.key==="Enter"||y.key===" ")&&(y.preventDefault(),u.click())}),E.appendChild(u)}),this.plugin.settings.htmlRegexReplacements.length===0){let r=f.createEl("tr").createEl("td");r.colSpan=3,r.addClass("regex-empty-message"),r.setText("No replacements defined. Click the + icon below to add one.")}let p=g.createEl("div");p.className="regex-add-icon",p.setAttribute("title","Add replacement"),p.setAttribute("aria-label","Add replacement"),p.setAttribute("role","button"),p.setAttribute("tabindex","0"),(0,i.setIcon)(p,"plus-circle"),p.addEventListener("click",()=>{if(!this.plugin.settings.htmlRegexReplacements.some(r=>r.pattern===""&&r.replacement==="")){this.plugin.settings.htmlRegexReplacements.push({pattern:"",replacement:""});let r=this.containerEl.scrollTop;this.plugin.saveSettings().then(()=>{this.display(),this.containerEl.scrollTop=r,this.scrollNewRowIntoView("html")})}}),p.addEventListener("keydown",o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),p.click())}),new i.Setting(e).setName("Markdown transformations").setDesc("Control how the Markdown content is adjusted after HTML conversion or when pasted as plain text.").setHeading(),new i.Setting(e).setName("Max heading level").setDesc("The maximum heading level to allow when reformatting pasted content (H1 is treated as disabled)").addDropdown(o=>o.addOptions({1:"Disabled (H1)",2:"H2",3:"H3",4:"H4",5:"H5",6:"H6"}).setValue(this.plugin.settings.maxHeadingLevel.toString()).onChange(async r=>{this.plugin.settings.maxHeadingLevel=parseInt(r),await this.plugin.saveSettings(),this.display()})),this.plugin.settings.maxHeadingLevel>1&&new i.Setting(e).setName("Cascade heading levels").setDesc("Preserve the heading hierarchy by cascading levels (e.g., H1\u2192H2\u2192H3 becomes H2\u2192H3\u2192H4 when max level is H2)").addToggle(o=>o.setValue(this.plugin.settings.cascadeHeadingLevels).onChange(async r=>{this.plugin.settings.cascadeHeadingLevels=r,await this.plugin.saveSettings()})),new i.Setting(e).setName("Contextual cascade").setDesc("Cascade headings based on the current context (e.g., if cursor is in an H2 section, headings will start from H3)").addToggle(o=>o.setValue(this.plugin.settings.contextualCascade).onChange(async r=>{this.plugin.settings.contextualCascade=r,await this.plugin.saveSettings()})),new i.Setting(e).setName("Remove empty lines").setDesc("Remove blank lines in the Markdown output").addToggle(o=>o.setValue(this.plugin.settings.removeEmptyLines).onChange(async r=>{this.plugin.settings.removeEmptyLines=r,await this.plugin.saveSettings()})),new i.Setting(e).setName("Markdown regex replacements").setDesc("Apply regular expression replacements to the Markdown content after HTML conversion. You can use $1, $2, etc. to reference capture groups.");let m=e.createDiv();m.addClass("regex-replacements-container");let T=m.createEl("table");T.addClass("regex-table");let k=T.createEl("thead").createEl("tr"),H=k.createEl("th");H.setText("Pattern"),H.addClass("regex-th"),H.addClass("regex-th-pattern");let A=k.createEl("th");A.setText("Replacement"),A.addClass("regex-th"),A.addClass("regex-th-replacement");let D=k.createEl("th");D.addClass("regex-th"),D.addClass("regex-th-actions");let $=T.createEl("tbody");if(this.plugin.settings.markdownRegexReplacements.forEach((o,r)=>{let w=$.createEl("tr"),R=w.createEl("td");R.addClass("regex-td");let x=document.createElement("input");x.type="text",x.value=o.pattern,x.placeholder="Regular expression pattern",x.addClass("regex-input"),x.addEventListener("change",async()=>{this.plugin.settings.markdownRegexReplacements[r].pattern=x.value,await this.plugin.saveSettings()}),R.appendChild(x);let C=w.createEl("td");C.addClass("regex-td");let v=document.createElement("input");v.type="text",v.value=o.replacement,v.placeholder="Replacement value (can use $1, $2, etc.)",v.addClass("regex-input"),v.addEventListener("change",async()=>{this.plugin.settings.markdownRegexReplacements[r].replacement=v.value,await this.plugin.saveSettings()}),C.appendChild(v);let E=w.createEl("td");E.addClass("regex-td"),E.addClass("regex-td-actions");let u=document.createElement("span");u.className="regex-remove-icon",u.setAttribute("title","Delete"),u.setAttribute("aria-label","Delete"),u.setAttribute("role","button"),u.setAttribute("tabindex","0"),(0,i.setIcon)(u,"trash-2"),u.addEventListener("click",async()=>{this.plugin.settings.markdownRegexReplacements.splice(r,1),await this.plugin.saveSettings(),this.display()}),u.addEventListener("keydown",y=>{(y.key==="Enter"||y.key===" ")&&(y.preventDefault(),u.click())}),E.appendChild(u)}),this.plugin.settings.markdownRegexReplacements.length===0){let r=$.createEl("tr").createEl("td");r.colSpan=3,r.addClass("regex-empty-message"),r.setText("No replacements defined. Click the + icon below to add one.")}let b=m.createEl("div");b.className="regex-add-icon",b.setAttribute("title","Add replacement"),b.setAttribute("aria-label","Add replacement"),b.setAttribute("role","button"),b.setAttribute("tabindex","0"),(0,i.setIcon)(b,"plus-circle"),b.addEventListener("click",()=>{if(!this.plugin.settings.markdownRegexReplacements.some(r=>r.pattern===""&&r.replacement==="")){this.plugin.settings.markdownRegexReplacements.push({pattern:"",replacement:""});let r=this.containerEl.scrollTop;this.plugin.saveSettings().then(()=>{this.display(),this.containerEl.scrollTop=r,this.scrollNewRowIntoView("markdown")})}}),b.addEventListener("keydown",o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),b.click())})}};

/* nosourcemap */